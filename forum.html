<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Forum MangaArt</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h2 { color: #e63946; }
    input, textarea, button { display: block; margin: 10px 0; width: 100%; padding: 10px; }
    .topic { background: #fff; padding: 15px; margin-bottom: 20px; border-left: 5px solid #e63946; border-radius: 8px; }
    .reply { background: #eee; padding: 10px; margin-top: 10px; border-radius: 6px; }
    .reply-form { margin-top: 10px; }
    .meta { font-size: 0.9em; color: #555; margin-bottom: 10px; }
    .delete-btn { background: #e63946; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; margin-top: 5px; }
    .delete-btn:hover { background: #c82333; }
  </style>
</head>
<body>

  <h2>CrÃ©er un nouveau sujet</h2>
  <input type="text" id="pseudo" placeholder="Votre pseudo">
  <input type="text" id="topicTitle" placeholder="Titre du sujet">
  <textarea id="topicContent" placeholder="Contenu du sujet"></textarea>
  <button onclick="addTopic()">Publier</button>

  <h2>Sujets du forum</h2>

<input type="text" id="searchInput" placeholder="Rechercher un sujet..." oninput="displayTopics()">
<select id="sortSelect" onchange="displayTopics()">
  <option value="desc">ğŸ“… Plus rÃ©cents d'abord</option>
  <option value="asc">ğŸ“… Plus anciens d'abord</option>
</select>

<div id="forum"></div>

  <div id="forum"></div>

  <script>
    let topics = JSON.parse(localStorage.getItem("topics")) || [];

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString("fr-FR", { dateStyle: "medium", timeStyle: "short" });
    }

    function addTopic() {
      const pseudo = document.getElementById("pseudo").value.trim();
      const title = document.getElementById("topicTitle").value.trim();
      const content = document.getElementById("topicContent").value.trim();

      if (pseudo && title && content) {
        topics.push({
          title,
          content,
          pseudo,
          createdAt: new Date().toISOString(),
          replies: []
        });
        localStorage.setItem("topics", JSON.stringify(topics));
        displayTopics();
        document.getElementById("topicTitle").value = "";
        document.getElementById("topicContent").value = "";
      }
    }

    function addReply(index) {
      const replyPseudo = document.getElementById(`replyPseudo${index}`).value.trim();
      const replyContent = document.getElementById(`replyContent${index}`).value.trim();

      if (replyPseudo && replyContent) {
        topics[index].replies.push({
          pseudo: replyPseudo,
          content: replyContent,
          createdAt: new Date().toISOString()
        });
        localStorage.setItem("topics", JSON.stringify(topics));
        displayTopics();
      }
    }

    function deleteTopic(index) {
      if (confirm("Supprimer ce sujet ?")) {
        topics.splice(index, 1);
        localStorage.setItem("topics", JSON.stringify(topics));
        displayTopics();
      }
    }

    function deleteReply(topicIndex, replyIndex) {
      if (confirm("Supprimer cette rÃ©ponse ?")) {
        topics[topicIndex].replies.splice(replyIndex, 1);
        localStorage.setItem("topics", JSON.stringify(topics));
        displayTopics();
      }
    }

function displayTopics() {
  const forum = document.getElementById("forum");
  const searchTerm = document.getElementById("searchInput").value.toLowerCase();
  const sortOrder = document.getElementById("sortSelect").value;

  let filteredTopics = topics.filter(t =>
    t.title.toLowerCase().includes(searchTerm) ||
    t.content.toLowerCase().includes(searchTerm)
  );

  filteredTopics.sort((a, b) => {
    const dateA = new Date(a.createdAt);
    const dateB = new Date(b.createdAt);
    return sortOrder === "asc" ? dateA - dateB : dateB - dateA;
  });

  forum.innerHTML = "";

  filteredTopics.forEach((t, i) => {
    let html = `<div class="topic">
      <h3>${t.title}</h3>
      <p>${t.content}</p>
      <div class="meta">PostÃ© par <strong>${t.pseudo}</strong> le ${formatDate(t.createdAt)}</div>
      <button class="delete-btn" onclick="deleteTopic(${i})">ğŸ—‘ï¸ Supprimer le sujet</button>`;

    if (t.replies.length > 0) {
      html += `<h4>RÃ©ponses :</h4>`;
      t.replies.forEach((r, j) => {
        html += `<div class="reply">
          <strong>${r.pseudo}</strong> : ${r.content}
          <div class="meta">PubliÃ© le ${formatDate(r.createdAt)}</div>
          <button class="delete-btn" onclick="deleteReply(${i}, ${j})">ğŸ—‘ï¸ Supprimer la rÃ©ponse</button>
        </div>`;
      });
    }

    html += `
      <div class="reply-form">
        <input type="text" id="replyPseudo${i}" placeholder="Votre pseudo">
        <textarea id="replyContent${i}" placeholder="Votre rÃ©ponse"></textarea>
        <button onclick="addReply(${i})">RÃ©pondre</button>
      </div>
    </div>`;

    forum.innerHTML += html;
  });
}


        html += `
          <div class="reply-form">
            <input type="text" id="replyPseudo${i}" placeholder="Votre pseudo">
            <textarea id="replyContent${i}" placeholder="Votre rÃ©ponse"></textarea>
            <button onclick="addReply(${i})">RÃ©pondre</button>
          </div>
        </div>`;

        forum.innerHTML += html;
      });
    }

    displayTopics();
  </script>

</body>
</html>
